<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Block Blast - MINH HAI DEVELOPER</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #2a2e4a;
      color: white;
      text-align: center;
      padding: 20px;
    }

    #board {
      display: grid;
      grid-template-columns: repeat(8, 40px);
      grid-template-rows: repeat(8, 40px);
      gap: 2px;
      justify-content: center;
      margin: 0 auto 20px;
    }

    .cell {
      width: 40px;
      height: 40px;
      border: 1px solid #444;
      background-color: #6b7ac4;
      box-sizing: border-box;
      transition: background-color 0.3s, transform 0.4s ease;
    }

    .cell.filled {
      background-color: limegreen;
    }

    .cell.highlight {
      background-color: gold !important;
    }

    .cell.shrink {
      transform: scale(0);
    }

    #block-options {
      display: flex;
      gap: 20px;
      margin-top: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .block {
      display: grid;
      gap: 2px;
      padding: 5px;
      background: transparent;
      cursor: pointer;
      width: fit-content;
      grid-template-columns: repeat(3, 1fr);
    }

    .block.selected .block-cell.filled {
      outline: 2px solid orange;
    }

    .block-cell {
      width: 20px;
      height: 20px;
      background-color: transparent;
    }

    .block-cell.filled {
      background-color: steelblue;
      border-radius: 3px;
    }

    button {
      font-size: 120%;
      background: #a17474;
      color: white;
      border: none;
      padding: 8px 16px;
      cursor: pointer;
      margin-top: 10px;
    }

    #game-over {
      font-size: 24px;
      color: red;
      display: none;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1 style="color: cyan;">Block Blast</h1>
  <h2 style="color: #ffaaaa;">MINH HAI DEVELOPER</h2>
  <div id="board"></div>
  <div id="block-options"></div>
  <h3>Score: <span id="score">0</span></h3>
  <div id="game-over">Game Over!</div>
  <button onclick="restartGame()">Restart</button>

  <script>
    const board = document.getElementById("board");
    const blockOptions = document.getElementById("block-options");
    const gridSize = 8;
    let grid = new Array(gridSize * gridSize).fill(0);
    let blocks = [];
    let selectedBlock = null;
    let score = 0;

    const blockTemplates = [
      [[1, 1, 0], [1, 1, 0], [0, 0, 0]],
      [[1, 1, 1], [0, 0, 0], [0, 0, 0]],
      [[1, 0, 0], [1, 0, 0], [1, 0, 0]],
      [[0, 1, 0], [1, 1, 1], [0, 0, 0]],
      [[1, 1, 1], [1, 0, 0], [0, 0, 0]],
      [[0, 1, 1], [1, 1, 0], [0, 0, 0]],
    ];

    function renderBoard() {
      board.innerHTML = "";
      for (let i = 0; i < gridSize * gridSize; i++) {
        const cell = document.createElement("div");
        cell.className = "cell";
        if (grid[i] === 1) cell.classList.add("filled");
        cell.dataset.index = i;
        cell.addEventListener("click", () => placeBlock(i));
        board.appendChild(cell);
      }
    }

    function generateRandomBlocks() {
      blocks = [];
      for (let i = 0; i < 3; i++) {
        const block = blockTemplates[Math.floor(Math.random() * blockTemplates.length)];
        blocks.push(block.map(row => [...row]));
      }
    }

    function renderBlocks() {
      blockOptions.innerHTML = "";
      blocks.forEach((block, i) => {
        const div = document.createElement("div");
        div.className = "block";
        if (selectedBlock === i) div.classList.add("selected");
        block.flat().forEach(val => {
          const cell = document.createElement("div");
          cell.className = "block-cell";
          if (val === 1) cell.classList.add("filled");
          else cell.style.visibility = "hidden";
          div.appendChild(cell);
        });
        div.addEventListener("click", () => {
          selectedBlock = i;
          renderBlocks();
        });
        blockOptions.appendChild(div);
      });
    }

    function placeBlock(index) {
      if (selectedBlock === null) return;
      const row = Math.floor(index / gridSize);
      const col = index % gridSize;
      const block = blocks[selectedBlock];

      for (let i = 0; i < 3; i++) {
        for (let j = 0; j < 3; j++) {
          if (block[i][j] === 0) continue;
          const r = row + i;
          const c = col + j;
          if (r >= gridSize || c >= gridSize) return;
          if (grid[r * gridSize + c] === 1) return;
        }
      }

      for (let i = 0; i < 3; i++) {
        for (let j = 0; j < 3; j++) {
          if (block[i][j] === 1) {
            const r = row + i;
            const c = col + j;
            grid[r * gridSize + c] = 1;
          }
        }
      }

      blocks.splice(selectedBlock, 1);
      selectedBlock = null;
      renderBlocks();
      renderBoard();
      clearLines();

      if (blocks.length === 0) {
        generateRandomBlocks();
        renderBlocks();
      }

      if (!canPlaceAnyBlock()) {
        document.getElementById("game-over").style.display = "block";
      }
    }

    function clearLines() {
      const rows = [];
      const cols = [];

      for (let r = 0; r < gridSize; r++) {
        if (grid.slice(r * gridSize, (r + 1) * gridSize).every(v => v === 1)) rows.push(r);
      }

      for (let c = 0; c < gridSize; c++) {
        let full = true;
        for (let r = 0; r < gridSize; r++) {
          if (grid[r * gridSize + c] === 0) {
            full = false;
            break;
          }
        }
        if (full) cols.push(c);
      }

      if (rows.length === 0 && cols.length === 0) return;

      rows.forEach(r => {
        for (let c = 0; c < gridSize; c++) {
          const cell = board.children[r * gridSize + c];
          if (cell) cell.classList.add("highlight");
        }
      });

      cols.forEach(c => {
        for (let r = 0; r < gridSize; r++) {
          const cell = board.children[r * gridSize + c];
          if (cell) cell.classList.add("highlight");
        }
      });

      setTimeout(() => {
        rows.forEach(r => {
          for (let c = 0; c < gridSize; c++) {
            const idx = r * gridSize + c;
            grid[idx] = 0;
            const cell = board.children[idx];
            if (cell) {
              cell.classList.add("shrink");
              setTimeout(() => cell.classList.remove("shrink"), 300);
            }
          }
        });

        cols.forEach(c => {
          for (let r = 0; r < gridSize; r++) {
            const idx = r * gridSize + c;
            grid[idx] = 0;
            const cell = board.children[idx];
            if (cell) {
              cell.classList.add("shrink");
              setTimeout(() => cell.classList.remove("shrink"), 300);
            }
          }
        });

        score += (rows.length + cols.length) * 10;
        setTimeout(() => {
          renderBoard();
          document.getElementById("score").textContent = score;
        }, 350);
      }, 400);
    }

    function canPlaceAnyBlock() {
      for (const block of blocks) {
        for (let r = 0; r <= gridSize - 3; r++) {
          for (let c = 0; c <= gridSize - 3; c++) {
            if (canPlaceAt(block, r, c)) return true;
          }
        }
      }
      return false;
    }

    function canPlaceAt(block, row, col) {
      for (let i = 0; i < 3; i++) {
        for (let j = 0; j < 3; j++) {
          if (block[i][j] === 0) continue;
          const r = row + i;
          const c = col + j;
          if (r >= gridSize || c >= gridSize) return false;
          if (grid[r * gridSize + c] === 1) return false;
        }
      }
      return true;
    }

    function restartGame() {
      grid = new Array(gridSize * gridSize).fill(0);
      score = 0;
      selectedBlock = null;
      document.getElementById("game-over").style.display = "none";
      generateRandomBlocks();
      renderBoard();
      renderBlocks();
      document.getElementById("score").textContent = score;
    }

    // Init
    generateRandomBlocks();
    renderBoard();
    renderBlocks();
  </script>
</body>
</html>
